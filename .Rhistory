library(grid)
?unit()
unit(1, "mm")
?convertUnit()
convertUnit(unit(1, "inches", "cm"))
convertUnit(unit(1, "inches"), "cm"))
convertUnit(unit(1, "inches"), "cm")
setwd("C:/Users/m1861/Desktop/CPLN790_MUSAPracticum/MUSA801_PLA")
setwd("G:/UPenn/Practice/RA_prfEG/Zonal APC predictions")
knitr::opts_chunk$set(echo = TRUE)
dat_tract_nozero <- readRDS("ridership_tractlevel_dataset_regressionReady_beforeApr26_noZero_1202.rds")
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(kableExtra)
library(tigris)
library(mapview)
library(tidyverse)
library(tidycensus)
source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")
qBr <- function(df, variable, rnd) {
if (missing(rnd)) {
as.character(quantile(round(df[[variable]],2),
c(.01,.2,.4,.6,.8), na.rm=T))
} else if (rnd == FALSE | rnd == F) {
as.character(formatC(quantile(df[[variable]],
c(.01,.2,.4,.6,.8), na.rm=T), digits = 3))
}
}
dat_tract_nozero$tr_Jobs_in_45mins
palette5 <- c("#f0f9e8","#bae4bc","#7bccc4","#139ed1","#0868ac")
dat_tract_nozero %>%
ggplot() +
geom_sf(aes(fill = q5(tr_Jobs_in_45mins)), color = NA) +
scale_fill_manual(values = palette5,
labels = qBr(dat_tract_nozero "tr_Jobs_in_45mins"),
dat_tract_nozero %>%
ggplot() +
geom_sf(aes(fill = q5(tr_Jobs_in_45mins)), color = NA) +
scale_fill_manual(values = palette5,
labels = qBr(dat_tract_nozero "tr_Jobs_in_45mins")) +
dat_tract_nozero %>%
ggplot() +
geom_sf(aes(fill = q5(tr_Jobs_in_45mins)), color = NA) +
scale_fill_manual(values = palette5,
) +
geom_sf(data = phltracts %>%
filter(GEOID %in% c('42101001202','42101023700')) %>%
st_union(),
color = "#ff5500",
fill = "transparent") +
labs(title = "Median Household Income", subtitle = "Philadelphia County 2019") +
mapTheme() +
theme(legend.position = "bottom",
panel.border = element_blank(),
panel.background = element_rect(fill = "#333333"),
panel.grid = element_blank(),
strip.background = element_rect(fill = "#333333"),
strip.text.x = element_text(size = 8, color = '#ffffff', hjust=0.01)
)
phlcrs <- 'EPSG:32129' #'EPSG:3364' #'EPSG:4269'
# get geometry for the county of Philadelphia
phlcounty <- tigris::counties(state = 42) %>%
filter(GEOID == '42101') %>%
dplyr::select(GEOID, geometry) %>%
st_transform(st_crs(phlcrs))
dat_tract_nozero %>%
ggplot() +
geom_sf(aes(fill = q5(tr_Jobs_in_45mins)), color = NA) +
scale_fill_manual(values = palette5) +
geom_sf(data = phlcounty,
color = "#ff5500",
fill = "transparent") +
labs(title = "Median Household Income", subtitle = "Philadelphia County 2019") +
mapTheme() +
theme(legend.position = "bottom",
panel.border = element_blank(),
panel.background = element_rect(fill = "#333333"),
panel.grid = element_blank(),
strip.background = element_rect(fill = "#333333"),
strip.text.x = element_text(size = 8, color = '#ffffff', hjust=0.01)
)
phltracts <- tigris::tracts(state = 42, county = 101) %>%
dplyr::select(GEOID, geometry)
job_access <- dat_tract_nozero %>%
select(AFFGEOID_in, tr_Jobs_in_45mins)
dat <- left_join(phltracts, job_access, by=c("GEOID", "AFFGEOID_in"))
dat <- left_join(phltracts, job_access, by=c("GEOID"="AFFGEOID_in"))
View(dat)
View(dat_tract_nozero)
job_access <- dat_tract_nozero %>%
select(AFFGEOID_in, tr_Jobs_in_45mins) %>%
mutate(GEOID = right(AFFGEOID_in, 11))
job_access <- dat_tract_nozero %>%
select(AFFGEOID_in, tr_Jobs_in_45mins) %>%
mutate(GEOID = substr(AFFGEOID_in, 10,21))
View(job_access)
dat <- left_join(phltracts, job_access, by=c("GEOID"="AFFGEOID_in"))
View(dat)
typeof(job_access$GEOID)
typeof(phltracts$GEOID)
View(job_access)
View(job_access)
View(dat_tract_nozero)
job_access <- dat_tract_nozero %>%
select(AFFGEOID_in, tr_Jobs_in_45mins) %>%
mutate(GEOID = substr(AFFGEOID_in, 10, 21)) %>%
group_by(GEOID) %>%
summarise(tr_Jobs_in_45mins = mean())
job_access <- dat_tract_nozero %>%
select(AFFGEOID_in, tr_Jobs_in_45mins) %>%
mutate(GEOID = substr(AFFGEOID_in, 10, 21)) %>%
group_by(GEOID) %>%
summarise(tr_Jobs_in_45mins = mean(.))
View(job_access)
job_access <- dat_tract_nozero %>%
select(AFFGEOID_in, tr_Jobs_in_45mins) %>%
mutate(GEOID = substr(AFFGEOID_in, 10, 21)) %>%
group_by(GEOID) %>%
summarise(tr_Jobs_in_45mins = mean(.), na.rm=T)
job_access <- dat_tract_nozero %>%
select(AFFGEOID_in, tr_Jobs_in_45mins) %>%
mutate(GEOID = substr(AFFGEOID_in, 10, 21)) %>%
group_by(GEOID) %>%
summarise(tr_Jobs_in_45mins = mean(., na.rm=T))
View(job_access)
job_access <- dat_tract_nozero %>%
select(AFFGEOID_in, tr_Jobs_in_45mins) %>%
filter(is.na(tr_Jobs_in_45mins)==F) %>%
mutate(GEOID = substr(AFFGEOID_in, 10, 21)) %>%
group_by(GEOID) %>%
summarise(tr_Jobs_in_45mins = mean(.))
job_access <- dat_tract_nozero %>%
select(AFFGEOID_in, tr_Jobs_in_45mins) %>%
filter(is.na(tr_Jobs_in_45mins)==F) %>%
mutate(GEOID = substr(AFFGEOID_in, 10, 21)) %>%
group_by(GEOID) %>%
summarise(tr_Jobs_in_45mins = mean(as.numeric(tr_Jobs_in_45mins)))
View(job_access)
dat <- left_join(phltracts, job_access, by=c("GEOID"="AFFGEOID_in"))
dat <- left_join(phltracts, job_access, by=c("GEOID"))
View(dat)
dat %>%
ggplot() +
geom_sf(aes(fill = q5(tr_Jobs_in_45mins)), color = NA) +
scale_fill_manual(values = palette5,
labels = qBr(dat "tr_Jobs_in_45mins"),
dat %>%
ggplot() +
geom_sf(aes(fill = q5(tr_Jobs_in_45mins)), color = NA) +
scale_fill_manual(values = palette5,
labels = qBr(dat, "tr_Jobs_in_45mins"),
name = "Median Income\n(USD)") +
geom_sf(data = phlcounty,
color = "#ff5500",
fill = "transparent") +
labs(title = "Median Household Income", subtitle = "Philadelphia County 2019") +
mapTheme() +
theme(legend.position = "bottom",
panel.border = element_blank(),
panel.background = element_rect(fill = "#333333"),
panel.grid = element_blank(),
strip.background = element_rect(fill = "#333333"),
strip.text.x = element_text(size = 8, color = '#ffffff', hjust=0.01)
)
dat %>%
ggplot() +
geom_sf(aes(fill = q5(tr_Jobs_in_45mins)), color = NA) +
scale_fill_manual(values = palette5,
labels = qBr(dat, "tr_Jobs_in_45mins"),
name = "job accessible in 45 min transit") +
geom_sf(data = phlcounty,
color = "#ff5500",
fill = "transparent") +
labs(title = "Median Household Income", subtitle = "Philadelphia County 2019") +
mapTheme() +
theme(legend.position = "bottom",
panel.border = element_blank(),
panel.background = element_rect(fill = "#333333"),
panel.grid = element_blank(),
strip.background = element_rect(fill = "#333333"),
strip.text.x = element_text(size = 8, color = '#ffffff', hjust=0.01)
)
dat %>%
ggplot() +
geom_sf(aes(fill = q5(tr_Jobs_in_45mins)), color = NA) +
scale_fill_manual(values = palette5,
labels = qBr(dat, "tr_Jobs_in_45mins"),
name = "") +
geom_sf(data = phlcounty,
color = "#ff5500",
fill = "transparent") +
labs(title = "job accessible in 45 min transit", subtitle = "Philadelphia County 2019") +
mapTheme() +
theme(legend.position = "bottom",
panel.border = element_blank(),
panel.background = element_rect(fill = "#333333"),
panel.grid = element_blank(),
strip.background = element_rect(fill = "#333333"),
strip.text.x = element_text(size = 8, color = '#ffffff', hjust=0.01)
)
dat %>%
ggplot() +
geom_sf(aes(fill = q5(tr_Jobs_in_45mins)), color = NA) +
scale_fill_manual(values = palette5,
labels = qBr(dat, "tr_Jobs_in_45mins"),
name = "") +
geom_sf(data = phlcounty,
#color = "#ff5500",
fill = "transparent") +
labs(title = "job accessible in 45 min transit", subtitle = "Philadelphia County 2019") +
mapTheme() +
theme(legend.position = "bottom",
panel.border = element_blank(),
panel.background = element_rect(fill = "#333333"),
panel.grid = element_blank(),
strip.background = element_rect(fill = "#333333"),
strip.text.x = element_text(size = 8, color = '#ffffff', hjust=0.01)
)
zip <- st_read('https://opendata.arcgis.com/datasets/b54ec5210cee41c3a884c9086f7af1be_0.geojson')
zip <- st_read('https://opendata.arcgis.com/datasets/b54ec5210cee41c3a884c9086f7af1be_0.geojson') %>%
st_transform(st_crs(phlcrs))
View(zip)
zillow_rent <- read.csv("./data/Zip_ZORI_AllHomesPlusMultifamily_Smoothed.csv")
getwd()
setwd("C:/Users/m1861/Desktop/CPLN790_MUSAPracticum/MUSA801_PLA")
zillow_rent <- read.csv("./data/Zip_ZORI_AllHomesPlusMultifamily_Smoothed.csv")
setwd("C:/Users/m1861/Desktop/CPLN790_MUSAPracticum/MUSA801_PLA")
zillow_rent <- read.csv("./data/Zip_ZORI_AllHomesPlusMultifamily_Smoothed.csv")
View(zillow_rent)
zRent <- left_join(zip, zillow_rent, by=c("CODE", "RegionName"))
zillow_rent$RegionName
zRent <- left_join(zip, zillow_rent, by=c("CODE"="RegionName"))
zillow_rent <- read.csv("./data/Zip_ZORI_AllHomesPlusMultifamily_Smoothed.csv") %>%
mutate(RegionName = as.character(RegionName))
zRent <- left_join(zip, zillow_rent, by=c("CODE"="RegionName"))
View(zRent)
ggplot %>%
geom_sf(zRent, aes(X2022.01))
ggplot %>%
geom_sf(aes(fill = q5(zRent$X2022.01)), color = NA) +
scale_fill_manual(values = palette5,
labels = qBr(dat, "tr_Jobs_in_45mins"),
name = "")
zRent %>%
ggplot +
geom_sf(aes(fill = q5(X2022.01)), color = NA) +
scale_fill_manual(values = palette5,
labels = qBr(dat, "tr_Jobs_in_45mins"),
name = "")
